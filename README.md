# 微服务
## 技术背景
### 什么是微服务
微服务的概念源于2014年3月Martin Fowler所写的一篇文章“Microservices”。

微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，服务之间互相协调、互相配合，为用户提供最终价值。每个服务运行在其独立的进程中，服务与服务间采用轻量级的通信机制互相沟通（通常是基于HTTP的RESTful API）。每个服务都围绕着具体业务进行构建，并且能够被独立地部署到生产环境、类生产环境等。另外，应尽量避免统一的、集中式的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。

微服务是一种架构风格，一个大型复杂软件应用由一个或多个微服务组成。系统中的各个微服务可被独立部署，各个微服务之间是松耦合的。每个微服务仅关注于完成一件任务并很好地完成该任务。在所有情况下，每个任务代表着一个小的业务能力。

### 微服务架构优势
1. 复杂度可控：在将应用分解的同时，规避了原本复杂度无止境的积累。每一个微服务专注于单一功能，并通过定义良好的接口清晰表述服务边界。由于体积小、复杂度低，每个微服务可由一个小规模开发团队完全掌控，易于保持高可维护性和开发效率。
2. 独立部署：由于微服务具备独立的运行进程，所以每个微服务也可以独立部署。当某个微服务发生变更时无需编译、部署整个应用。由微服务组成的应用相当于具备一系列可并行的发布流程，使得发布更加高效，同时降低对生产环境所造成的风险，最终缩短应用交付周期。
3. 技术选型灵活：微服务架构下，技术选型是去中心化的。每个团队可以根据自身服务的需求和行业发展的现状，自由选择最适合的技术栈。由于每个微服务相对简单，故需要对技术栈进行升级时所面临的风险就较低，甚至完全重构一个微服务也是可行的。
4. 容错：当某一组件发生故障时，在单一进程的传统架构下，故障很有可能在进程内扩散，形成应用全局性的不可用。在微服务架构下，故障会被隔离在单个服务中。若设计良好，其他服务可通过重试、平稳退化等机制实现应用层面的容错。
5. 扩展：单块架构应用也可以实现横向扩展，就是将整个应用完整的复制到不同的节点。当应用的不同组件在扩展需求上存在差异时，微服务架构便体现出其灵活性，因为每个服务可以根据实际需求独立进行扩展。

## 为什么考虑Spring Cloud
- Spring Cloud来源于Spring，质量、稳定性、持续性都可以得到保证
- Spring Cloud天然支持Spring Boot，更加便于业务落地。
- Spring Cloud发展非常的快，从16年开始接触的时候相关组件版本为1.x，到现在将要发布2.x系列
- Spring Cloud是Java领域最适合做微服务的框架。
- 相比于其它框架,Spring Cloud对微服务周边环境的支持力度最大。
- 对于中小企业来讲，使用门槛较低。
 
> Spring Cloud　是微服务架构的最佳落地方案

## Spring Cloud 架构
我们从整体来看一下Spring Cloud主要的组件，以及它的访问流程

![1581578491(1).jpg](https://upload-images.jianshu.io/upload_images/11571828-6f52260f24715ad7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- 1、外部或者内部的非Spring Cloud项目都统一通过API网关（Zuul）来访问内部服务.
- 2、网关接收到请求后，从注册中心（Eureka）获取可用服务
- 3、由Ribbon进行均衡负载后，分发到后端的具体实例
- 4、微服务之间通过Feign进行通信处理业务
- 5、Hystrix负责处理服务超时熔断
- 6、Turbine监控服务间的调用和熔断相关指标

所以，Spring Cloud的核心功能：
- 分布式/版本化配置
- 服务注册和发现
- 路由服务和服务之间的调用
- 负载均衡断路器
- 分布式消息传递

图中没有画出配置中心，配置中心管理各微服务不同环境下的配置文件。

以上就是一个完整的Spring Cloud生态图。

## eureka
1. pom 文件中的 eureka版本应当选择 springcloud 官网的最新版本，具体版本应该看官网，而不是看教程。
2. 使用 springcloud 的依赖版本管理
 
## 服务提供与调用
    1. 服务调用使用的 feign 调用，需要新增依赖 
           
 ```
 <dependency>          
     <groupId>org.springframework.cloud</groupId>          
    <artifactId>spring-cloud-starter-openfeign</artifactId>                                     <version>2.0.0.RELEASE</version>        
</dependency>
```

## 技术选型
详见技术选型文档
